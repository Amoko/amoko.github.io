<!DOCTYPE html>
<html lang="en-US">

<head>

    <meta charset="UTF-8">
    <link rel="icon" type="image/png"  href="/img/favicon.jinja.png">
<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Integral Image | Yonji’s Blog</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Integral Image" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="1 积分图 对于需要多次计算图像子区域像素值之和的算法，都可以采用积分图进行加速。 积分图上每一点的值 $sum(x,y)$ 是原图对应位置左上角矩形的像素和。 而关于这个矩形是否包含边缘，并没有一个统一的标准，因此积分图的定义有两种格式。 Wikipedia 的定义： inclusive，最终积分图尺寸为 $W \times H$。 OpenCV 的定义： exclusive，最终积分图尺寸 $(W+1) \times (H+1)$。 2 OpenCV中的积分图 2.1 python 从skimage库中读取一张RGB图片，转化为灰度图后，求积分图。 灰度图每个像素所占存储空间为8位，而积分图需要32位。 &gt;&gt;&gt; from skimage import data &gt;&gt;&gt; import cv2 as cv &gt;&gt;&gt; img = data.astronaut() &gt;&gt;&gt; grayImg = cv.cvtColor(img, cv.COLOR_BGR2GRAY) &gt;&gt;&gt; img_integral = cv.integral(grayImg) &gt;&gt;&gt; img.shape (512, 512, 3) &gt;&gt;&gt; grayImg.shape (512, 512) &gt;&gt;&gt; img_integral.shape (513, 513) &gt;&gt;&gt; type(grayImg[0][0]) &lt;class &#39;numpy.uint8&#39;&gt; &gt;&gt;&gt; type(img_integral[0][0]) &lt;class &#39;numpy.int32&#39;&gt; 2.2 C++ integral(grayImg, inteImg); 输入、输出的数据类型都为Mat，Mat.data的数据类型为 unsigned char* 灰度图、积分图的每个元素的数据类型分别为CV_8U、CV_32S tips 当使用一些第三方库对积分图进行加速优化时，需要特别注意 积分图定义方式，步长*数据类型长度。 Reference [1] Wikipedia Integral image [2] OpenCV docs Integral image [3] 積分画像の原理・計算式・高速化 [4] 13行代码实现最快速最高效的积分图像算法" />
<meta property="og:description" content="1 积分图 对于需要多次计算图像子区域像素值之和的算法，都可以采用积分图进行加速。 积分图上每一点的值 $sum(x,y)$ 是原图对应位置左上角矩形的像素和。 而关于这个矩形是否包含边缘，并没有一个统一的标准，因此积分图的定义有两种格式。 Wikipedia 的定义： inclusive，最终积分图尺寸为 $W \times H$。 OpenCV 的定义： exclusive，最终积分图尺寸 $(W+1) \times (H+1)$。 2 OpenCV中的积分图 2.1 python 从skimage库中读取一张RGB图片，转化为灰度图后，求积分图。 灰度图每个像素所占存储空间为8位，而积分图需要32位。 &gt;&gt;&gt; from skimage import data &gt;&gt;&gt; import cv2 as cv &gt;&gt;&gt; img = data.astronaut() &gt;&gt;&gt; grayImg = cv.cvtColor(img, cv.COLOR_BGR2GRAY) &gt;&gt;&gt; img_integral = cv.integral(grayImg) &gt;&gt;&gt; img.shape (512, 512, 3) &gt;&gt;&gt; grayImg.shape (512, 512) &gt;&gt;&gt; img_integral.shape (513, 513) &gt;&gt;&gt; type(grayImg[0][0]) &lt;class &#39;numpy.uint8&#39;&gt; &gt;&gt;&gt; type(img_integral[0][0]) &lt;class &#39;numpy.int32&#39;&gt; 2.2 C++ integral(grayImg, inteImg); 输入、输出的数据类型都为Mat，Mat.data的数据类型为 unsigned char* 灰度图、积分图的每个元素的数据类型分别为CV_8U、CV_32S tips 当使用一些第三方库对积分图进行加速优化时，需要特别注意 积分图定义方式，步长*数据类型长度。 Reference [1] Wikipedia Integral image [2] OpenCV docs Integral image [3] 積分画像の原理・計算式・高速化 [4] 13行代码实现最快速最高效的积分图像算法" />
<link rel="canonical" href="http://localhost:4000/2018/12/24/Integral-Image.html" />
<meta property="og:url" content="http://localhost:4000/2018/12/24/Integral-Image.html" />
<meta property="og:site_name" content="Yonji’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-24T00:00:00-08:00" />
<script type="application/ld+json">
{"description":"1 积分图 对于需要多次计算图像子区域像素值之和的算法，都可以采用积分图进行加速。 积分图上每一点的值 $sum(x,y)$ 是原图对应位置左上角矩形的像素和。 而关于这个矩形是否包含边缘，并没有一个统一的标准，因此积分图的定义有两种格式。 Wikipedia 的定义： inclusive，最终积分图尺寸为 $W \\times H$。 OpenCV 的定义： exclusive，最终积分图尺寸 $(W+1) \\times (H+1)$。 2 OpenCV中的积分图 2.1 python 从skimage库中读取一张RGB图片，转化为灰度图后，求积分图。 灰度图每个像素所占存储空间为8位，而积分图需要32位。 &gt;&gt;&gt; from skimage import data &gt;&gt;&gt; import cv2 as cv &gt;&gt;&gt; img = data.astronaut() &gt;&gt;&gt; grayImg = cv.cvtColor(img, cv.COLOR_BGR2GRAY) &gt;&gt;&gt; img_integral = cv.integral(grayImg) &gt;&gt;&gt; img.shape (512, 512, 3) &gt;&gt;&gt; grayImg.shape (512, 512) &gt;&gt;&gt; img_integral.shape (513, 513) &gt;&gt;&gt; type(grayImg[0][0]) &lt;class &#39;numpy.uint8&#39;&gt; &gt;&gt;&gt; type(img_integral[0][0]) &lt;class &#39;numpy.int32&#39;&gt; 2.2 C++ integral(grayImg, inteImg); 输入、输出的数据类型都为Mat，Mat.data的数据类型为 unsigned char* 灰度图、积分图的每个元素的数据类型分别为CV_8U、CV_32S tips 当使用一些第三方库对积分图进行加速优化时，需要特别注意 积分图定义方式，步长*数据类型长度。 Reference [1] Wikipedia Integral image [2] OpenCV docs Integral image [3] 積分画像の原理・計算式・高速化 [4] 13行代码实现最快速最高效的积分图像算法","@type":"BlogPosting","url":"http://localhost:4000/2018/12/24/Integral-Image.html","headline":"Integral Image","dateModified":"2018-12-24T00:00:00-08:00","datePublished":"2018-12-24T00:00:00-08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/12/24/Integral-Image.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=b0ca346b5b38b55e1001eb0920382c9d2e5aa454">

  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
</head>


  <body>
    <section class="page-header">
      <h1 class="project-name">Yonji's Blog|
      <a href="http://localhost:4000">Home</a></h1>
      <!--
      <h2 class="project-tagline">OMG! They killed Kenny!</h2>
      -->
      <a href="https://github.com/Amoko/amoko.github.io" class="btn">View on GitHub</a>
    
      
    </section>

    <section class="main-content">
      <h2 id="1-积分图">1 积分图</h2>

<p>对于需要多次计算图像子区域像素值之和的算法，都可以采用积分图进行加速。</p>

<p>积分图上每一点的值 $sum(x,y)$ 是原图对应位置左上角矩形的像素和。</p>

<p>而关于这个矩形是否包含边缘，并没有一个统一的标准，因此积分图的定义有两种格式。</p>

<p><strong>Wikipedia 的定义</strong>：</p>

<script type="math/tex; mode=display">sum(x,y)=\sum_{x'\leq x,y'\leq y}i(x',y')</script>

<p>inclusive，最终积分图尺寸为 $W \times H$。</p>

<p><strong>OpenCV  的定义</strong>：</p>

<script type="math/tex; mode=display">% <![CDATA[
sum(x,y)=\sum_{x'<x,y'<y}i(x',y') %]]></script>

<p>exclusive，最终积分图尺寸 $(W+1) \times (H+1)$。</p>

<h2 id="2-opencv中的积分图">2 OpenCV中的积分图</h2>

<h3 id="21-python">2.1 python</h3>

<p>从skimage库中读取一张RGB图片，转化为灰度图后，求积分图。</p>

<p>灰度图每个像素所占存储空间为8位，而积分图需要32位。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">cv2</span> <span class="k">as</span> <span class="n">cv</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">grayImg</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img_integral</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">grayImg</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">grayImg</span><span class="o">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img_integral</span><span class="o">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">513</span><span class="p">,</span> <span class="mi">513</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">grayImg</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="s">'&gt;</span><span class="err">
</span><span class="s">&gt;&gt;&gt; type(img_integral[0][0])</span><span class="err">
</span><span class="s">&lt;class '</span><span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="s">'&gt;</span><span class="err">
</span></code></pre></div></div>

<h3 id="22-c">2.2 C++</h3>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">integral</span><span class="p">(</span><span class="n">grayImg</span><span class="p">,</span> <span class="n">inteImg</span><span class="p">);</span>
</code></pre></div></div>

<p>输入、输出的数据类型都为Mat，Mat.data的数据类型为 unsigned char*</p>

<p>灰度图、积分图的每个元素的数据类型分别为CV_8U、CV_32S</p>

<p><strong>tips</strong></p>

<p>当使用一些第三方库对积分图进行加速优化时，需要特别注意 <strong>积分图定义方式</strong>，<strong>步长*数据类型长度</strong>。</p>

<h2 id="reference">Reference</h2>

<p>[1] <a href="https://en.wikipedia.org/wiki/Summed-area_table">Wikipedia Integral image</a></p>

<p>[2] <a href="https://docs.opencv.org/2.4/modules/imgproc/doc/miscellaneous_transformations.html#integral">OpenCV docs Integral image</a></p>

<p>[3] <a href="https://algorithm.joho.info/image-processing/integral-image/">積分画像の原理・計算式・高速化</a></p>

<p>[4] <a href="https://www.cnblogs.com/Imageshop/p/6219990.html">13行代码实现最快速最高效的积分图像算法</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/Amoko/amoko.github.io">amoko.github.io</a> is maintained by <a href="https://github.com/Amoko">Amoko</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </section>

    
  </body>
</html>
